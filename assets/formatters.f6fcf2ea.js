import{O as h,A as k,C as x,s as P,b as B,a as E,I as A,c as T}from"./common.7fda1e23.js";import{a as X}from"./monoids.4caa29cc.js";const W=t=>n=>t[n],Y=t=>t.length,D=t=>Math.min(...t),R=t=>D(t.map(Y)),S=t=>(...n)=>{const e=s=>r=>{const[c,...o]=r;if(o&&o.length){const i=W(s)(c);return e(i)(o)}else return W(s)(c)};return e(t)(n)},H=(t,n)=>{const e=t.length;return[t.slice(0,n),t.slice(n,e)]},Q=t=>{const n=t.length;return[t[0],t.slice(1,n)]},U=t=>{const n=t.length;return[t.slice(0,n-1),t[n-1]]},y=({append:t,empty:n})=>n===void 0?e=>e.reduce(t):e=>e.reduce(t,n),b=y(X),V=t=>(...n)=>Array.from({length:R(n)},(e,s)=>t(...n.map(r=>r[s]))),w=V;function J(t,n){function e(s,r){if(s&&s.length){const[c,...o]=s;return Array(c).fill(void 0).map((i,a)=>e(o,[...r,a]))}else return n(...r)}return e(t,[])}function g(t,n){const e=n-t;return Array.from({length:e},(s,r)=>r+t)}function z(t){return Array.isArray(t)?[t.length,...z(t[0])]:[]}const Z=({zero:t})=>(...n)=>J(n,()=>t),G=t=>(n,e)=>{const s=Z(t)(e);return s[n]=t.one,s};function tt(t,n){return t.slice(+n,t.length).concat(t.slice(0,+n))}function nt(t){return g(0,t.length).map(n=>tt(t,n))}const et=t=>n=>{const e=n.length;return n.map(s=>G(t)(s,e))},st=t=>n=>n.map(e=>et(t)(e)),rt=({one:t})=>[[[t]]],ot=t=>n=>[[[t.one,t.zero],[t.zero,t.one]],[[t.zero,t.one],[t.neg(n),t.zero]]],ct=t=>ot(t)(t.pos(t.one)),it=(t,n,e)=>n<=t&&t<e,q=w(it),at=w((t,n)=>t+n),ut=w((t,n)=>t-n),v=t=>(n,e)=>{const s=z(n),r=z(e),c=at(s,r);return J(c,(...o)=>{const i=o;if(b(q(i,[0,0,0],s)))return S(n)(...i);const a=ut(i,s);return b(q(a,[0,0,0],r))?S(e)(...a):t.zero})},mt=t=>n=>{const e=g(0,n);return st(t)(nt(e))},qt=t=>n=>{const e=rt(t),s=ct(t);switch(n){case 2:return v(t)(e,e);case 3:return v(t)(e,s);case 4:return v(t)(v(t)(e,s),e)}},Lt=mt,pt=(t,n)=>new h("==","equal",[t,n]),lt=(t,n)=>new h("!=","unequal",[t,n]),dt=(t,n)=>new h("+","add",[t,n]),ft=(t,n)=>new h("-","subtract",[t,n]),ht=(t,n)=>new h("*","multiply",[t,n],!0),yt=(t,n)=>new h("/","divide",[t,n]),I=t=>n=>new k(t,n),L={append:dt,empty:x(0)},j={append:ht,empty:x(1)},d=t=>n=>t.items[n],gt=({get:t,set:n})=>e=>(...s)=>{const r=c=>o=>{const[i,...a]=o;if(a&&a.length){const f=t(c)(i);return r(f)(a)}else return n(c)(i)};return r(e)(s)},$=gt({get:d,set:d});function m(t,n){function e(s,r){if(s&&s.length){const[c,...o]=s;return B(Array(c).fill(void 0).map((i,a)=>e(o,[...r,a])),s)}else return n(...r)}return e(t,[])}const jt=t=>{const n=P(t);return m(n,(...e)=>S(t)(...e))},vt=(t,n)=>m(n,(...e)=>I(E(t))(A(...e))),xt=(t,n)=>vt(t,[n]),Jt=({zero:t,add:n,mul:e})=>s=>r=>{const[c,o,i]=s.shape,a=y({append:n,empty:t});return m([c,o],(p,l)=>a(g(0,i).map(u=>e($(s)(p,l,u),d(r)(u)))))},Kt=({zero:t,add:n,mul:e})=>s=>r=>{const[c,o,i]=s.shape,a=y({append:n,empty:t});return m([i,o],(p,l)=>a(g(0,c).map(u=>e($(s)(u,l,p),d(r)(u)))))},Ot=({zero:t,add:n,mul:e})=>s=>r=>{const[c,o,i]=s.shape,a=y({append:n,empty:t});return m([c,i],(p,l)=>a(g(0,o).map(u=>e($(s)(p,u,l),d(r)(u)))))},Ct=t=>n=>e=>{const[s,r,c]=n.shape;return m([1,s],(o,i)=>d(e)(i))},Ft=t=>n=>e=>{const[s,r,c]=n.shape;return m([r,1],(o,i)=>d(e)(o))},N={one:L.empty,mul:L.append,div:ft,inv:t=>N.div(N.one,t)},_={one:j.empty,mul:j.append,div:yt,inv:t=>_.div(_.one,t)},$t={eq:pt,neq:lt},At=(t,n)=>({zero:t.one,add:t.mul,sub:t.div,add_inv:t.inv,one:n.one,mul:n.mul,div:n.div,mul_inv:n.inv,pos:e=>t.mul(t.one,e),neg:e=>t.div(t.one,e),inv:n.inv}),St=At(N,_),bt={...St,...$t},zt=bt,It=({zero:t,add:n,mul:e})=>(s,r)=>{const c=y({append:n,empty:t}),[o,i]=U(s.shape),[a,f]=Q(r.shape),p=[...o,...f],l=s.shape.length-1;return m(p,(...O)=>{const[C,F]=H(O,l);return c(g(0,Math.min(i,a)).map(M=>e(I(s)(A(...C,M)),I(r)(A(M,...F)))))})};function K(t,n,e){return t.isAccessorNode&&t.object.isArrayNode?$(t.object)(...t.index.dimensions).transform(K):t}function Nt(t,n,e){return t.isOperatorNode&&t.op==="*"&&b(t.args.map(s=>s.isArrayNode&&s.shape))?y({append:It(zt)})(t.args):t}const _t=t=>(n,e,s)=>(n.isOperatorNode&&n.op==="*"&&(n.implicit=t),n),kt=t=>T(t.transform(Nt).transform(K)).transform(_t(!0)),wt={x:t=>`\\xs{${t}}`,y:t=>`\\ys{${t}}`,u:t=>`\\us{${t}}`,v:t=>`\\vs{${t}}`,e:t=>`\\es{${t}}`,f:t=>`\\fs{${t}}`,X:(t,n)=>`\\Xs{${t}}{${n}}`,Y:(t,n)=>`\\Ys{${t}}{${n}}`,C:(t,n,e)=>`\\Cs{${t}}{${n}}{${e}}`};function Pt(t,n){if(t.type==="SymbolNode"&&t.unescaped)return t.name;if(t.type==="AccessorNode"&&t.object.type==="SymbolNode"){const e=wt[t.object.name];if(e)return` ${e(...t.index.dimensions)}`}}export{zt as S,Lt as a,Ft as b,Kt as c,Ot as d,kt as e,jt as f,Pt as g,mt as h,I as i,Jt as j,qt as m,xt as s,Ct as v};
